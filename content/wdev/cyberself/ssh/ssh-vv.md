+++
title = "Подключение по SSH"
date = "2020-04-18T10:59:33+03:00"
draft = false
toc = true
pygmentsUseClasses = true
navvvPravo = true
#summary="Управление содержимым - важнейшая задача на всех этапах создания, развития и поддержки сайта"
#description="Page_description"
#summaryImage="/images/vvv-1920x864.jpg"
tags = ["Hugo", "webdev"]
+++

# SSH

Как-то так случилось, что мне в основном приходилось заниматься рабочими станциями. О сети я всегда имел поверхностное представление, на уровне «что сделать, чтобы…». На словах Это казалось делом нелегким. Да и «околосетевые» слова выглядят сурово. Ну например «потокол», пароль, ключи, TCPIP и пр.

Но на деле, как всегда все оказывается проще. Главное — дорасти до, как сейчас говорят, «порога вхождения». То есть, накопить определенную сумму знаний по этой теме.

SSH — это просто протокол такой. Хороший и нужный. Ведь он позволяет вам выполнять команды в удаленной системе так, как будто вы это делаете на своем устройстве. В том числе, доступен буфер обмена, при введении команд и можно использовать их вывод. Недоступны лишь файлы из собственной файловой системы. Например, когда вы подключитесь к серверу по SSH из Debian, то все будет выглядеть так, как будто вы открыли терминал в своей системе
Как подключиться по SSH

Для подключения по SSH нам необходимо знать такие данные:

- ip адрес сервера, к которому мы собираемся подключится;
- порт, на котором ожидает подключения SSH сервер, по умолчанию используется 22, но в целях безопасности порт подключения ssh часто изменяют;
- имя и пароль пользователя на удаленном сервере.

Больше ничего не нужно, обычно эти данные присылают в письме вместе с описанием VPS. Теперь перейдем к практике.
SSH подключение в Linux

В Linux подключение по SSH выполняется с помощью утилиты ssh. Мы более подробно рассматривали работу с ней в статье как пользоваться ssh. Для подключения к удаленному компьютеру ее синтаксис будет выглядеть следующим образом:

```
    $ ssh имя_пользователя@айпи_адрес
```

Это самый простой вариант, если вам также нужно указать порт, используйте опцию -p:

```
    $ ssh имя_пользователя@айпи_адрес -p порт
```

Чтобы выполнить подключение по SSH Linux нажмите Ctrl+Alt+T для открытия терминала и наберите команду, заменив нужные значения:

    ssh den@192.168.1.6

Или, с нестандартным портом:

    ssh den@192.168.1.6 -p 2223

Если ip_адрес и порт правильные, для продолжения потребуется ввести пароль.
В Midnight Commander — MC

Несколько иной синтаксис при подключении при помощи консольного файл-менеджера MC:

    den@192.168.1.6:2223/home/ki/wCloud

Кое-что про Nautilus

Синтаксис в Nautilus тоже имеет свои особенности

    ssh://den@192.168.1.6:2223/home/ki/wCloud

Однако, этого мало. Требуется еще что-то… Скорее всего, авторизация только по ключу. Видимо, ужесточены требования безопасности.
Аутентификация без пароля

Это очень перспективная технолония. Ведь будущее — без пароля.

Для защиты динамических цифровых сред нужно избавиться от паролей. Так считает SSH.COM — одна из наиболее авторитетных компаний кибербезопасности (most trusted brands in cyber security).

В этом стоит разобраться поглубже. Ведь применение ssh пароля для входа на сервер не неудобно и опасно. Пароль в любой момент может быть засвечен. Более надежный и распространенный способ аутентификации — с помощью пары ключей RSA. Секретный ключ хранится на компьютере, а публичный применяется на сервере для удостоверения пользователя. Однако RSA устаревает. Об этом прямо заявлено на сайте SSH.COM.

    RSA стареет, и в факторинге достигнуты значительные успехи. Выбор другого алгоритма может быть более целесообразным. Вполне возможно, что алгоритм RSA станет практически сломанным в обозримом будущем.
    ssh-keygen — Generate a New SSH Key
    ssh.com — ssh-keygen

Современные ключи

Более современными, а, следовательно и более надежными ключами считаются ключи ecdsa и ed25519.

ecdsa
— новый алгоритм цифровой подписи, стандартизированный правительством США с использованием эллиптических кривых. Это, хороший алгоритм для текущих приложений. Поддерживаются только три размера ключа: 256, 384 и 521 (sic!) Бит. Мы рекомендуем всегда использовать его с 521 битом. Большинство клиентов SSH теперь поддерживают этот алгоритм.
ed25519
— новый алгоритм, добавленный в OpenSSH. Поддержка этого в клиентах еще не универсальна. Таким образом, его использование в приложениях общего назначения пока не рекомендуется.

Создание ключа

Алгоритм выбирается с помощью опции -t и размера ключа с помощью опции -b

Ключи создаются соответствующими командами:

    ssh-keygen -t rsa -b 4096
    ssh-keygen -t dsa
    ssh-keygen -t ecdsa -b 521
    ssh-keygen -t ed25519

Важно: ключи следует генерировать в директории назначения /home/w/.ssh/ — чтобы не пришлось переносить руками.
Указание имени файла

Обычно запрашивается файл, в котором следует сохранить ключ. Однако его также можно указать в командной строке с помощью параметра -f <имя файла> (например: tatu-key-ecdsa).

Практика:

    ssh-keygen -t ecdsa -b 521
    Generating public/private ecdsa key pair.
    Enter file in which to save the key (/home/w/.ssh/id_ecdsa): vvvkey-ecdsa
    Enter passphrase (empty for no passphrase):
    Enter same passphrase again:
    Your identification has been saved in vvvkey-ecdsa.
    Your public key has been saved in vvvkey-ecdsa.pub.
    The key fingerprint is:
    SHA256:0FJls1wkd8Y9ms+nsWE3zRsH5MmZw03lp2w2VYe70Qo w@deb-del
    The key's randomart image is:
    +---[ECDSA 521]---+
    |        ..=.+.oo=|
    |       o o * o+o=|
    |      o . o  =oO=|
    |       o    E+%o+|
    |        S    .OB.|
    |             o***|
    |             . **|
    |              o. |
    |                 |
    +----[SHA256]-----+

Все пошло нормально, но, было указано лишь имя файла, а путь — указывался, так как предполагалось, что все пойдет по умолчанию и файлы попадут в директорию подсказки /home/w/.ssh/id_ecdsa

    запросила имя файла
    Enter passphrase — потребовала фразу я не был готов к этому, в результате указал собачью.

Сначала инструмент спросил, где сохранить файл. Ключи SSH для аутентификации пользователя обычно хранятся в каталоге пользователя .ssh в домашнем каталоге. Однако в корпоративных средах расположение часто отличается.

Имя файла ключей по умолчанию зависит от алгоритма, в этом случае id_rsa при использовании алгоритма RSA по умолчанию. Это также может быть, например, id_dsa или id_ecdsa.

Затем он просит ввести пароль (passphrase). passphrase используется для шифрования ключа, поэтому его нельзя использовать, даже если кто-то получает файл закрытого ключа. Ключевая фраза должна быть криптографической. Наш онлайн генератор случайных паролей является одним из возможных инструментов для создания надежных парольных фраз.
Что такое пароль (passphrase)?

Ключевая фраза похожа на пароль. Тем не менее, пароль обычно относится к тому, что используется для аутентификации или входа в систему. Пароль обычно относится к секрету, используемому для защиты ключа шифрования. Обычно фактический ключ шифрования извлекается из ключевой фразы и используется для шифрования защищенного ресурса.
Это должно быть трудно угадать

Хорошая фраза должна содержать не менее 15, предпочтительно 20 символов, и ее трудно угадать. Он должен содержать заглавные буквы, строчные буквы, цифры и желательно хотя бы один знак пунктуации. Никакая часть этого не должна быть получена из личной информации о пользователе или его / ее семье.

    ssh-keygen -f ~/tatu-key-ecdsa -t ecdsa -b 521

Копирование открытого ключа на сервер

Для использования аутентификации с открытым ключом, необходимо этот ключ скопировать на сервер, и настроить в файле авторизованные ключи. Это удобно сделать с помощью команды ssh-copy-id:

    ssh-copy-id -i ~/.ssh/tatu-key-ecdsa user@host

После того, как открытый ключ был настроен на сервере, сервер позволит любому подключающемуся пользователю, у которого есть закрытый ключ, войти в систему. В процессе входа в систему клиент подтверждает владение секретным ключом, подписывая ключ цифровой подписью.

Я сгенерировал и скопировал на сервер SSH key при помощи Seahorse (Пароли и ключи). Вроле, все сделал правильно, но Seahorse закрылся (или упал) без каких-либо сообщений. Нужно поискать, как проверить, куда сохранился ключ и сохранился ли?
Добавление ключа к SSH агенту

ssh-agent — это программа, которая может хранить закрытый ключ пользователя, поэтому парольную фразу необходимо вводить только один раз.

GNOME Keyring includes an SSH agent that uses X.509 and/or OpenSSH encryption keys. Подробнее…

Соединение с агентом также может быть переадресовано при входе на сервер, что позволяет командам SSH на сервере использовать агент, работающий на рабочем столе пользователя.

В большинстве систем Linux ssh-agent автоматически настраивается и запускается при входе в систему, и для его использования не требуется никаких дополнительных действий. Однако ключ SSH все же должен быть создан для пользователя.

Если ssh-agent не запускается автоматически при входе в систему, его можно запустить вручную с помощью команды:

    eval `ssh-agent`

Для получения дополнительной информации об использовании и настройке агента SSH см. Страницу ssh-agent.
Создание ключей хоста

Инструмент также используется для создания ключей аутентификации хоста. Ключи хоста — это обычные пары ключей SSH. Каждый хост может иметь один ключ хоста для каждого алгоритма. Эта ключи обычно хранятся в следующих файлах:

Ключи хоста хранятся в каталоге / etc / ssh /.

    /etc/ssh/ssh_host_dsa_key
    /etc/ssh/ssh_host_ecdsa_key
    /etc/ssh/ssh_host_ed25519_key
    /etc/ssh/ssh_host_rsa_key

Приложения для управления ключами

Все можно делать в командной строке, а настройки выполнять в соответствующих конфигурационных файлах. Однако большую помощь могут оказать специальные программы (приложения) для управления ключами.
Seahorse (Пароли и ключи)

Seahorse — это приложение GNOME для управления ключами шифрования и паролями в связке ключей GNOME.

В дополнение к Seahorse можно использовать популярные кроссплатформенные KeePassXC или Bitwarden или что-то подобное. Опасно ли это. Конечно. Нужно очень осторожно применять, особенно мастерпароли. И своевременно их менять. И не только их

Seahorse

это GNOME Front-end и back-end приложение для управления PGP и SSH ключами. Поддерживает интеграцию в Nautilus, gedit и Evolution для шифрования/расшифровки и некоторых других криптографических операций. Также имеется поддержка к серверам ключей HKP и LDAP. Программа основана на GnuPG и распространяется как свободное программное обеспечение под лицензией GNU GPL
Seahorse Википедия — свободная энциклопедия

Seahorse — это GNOME Front-end и back-end приложение для управления PGP и SSH ключами. Поддерживает интеграцию в Nautilus, gedit и Evolution для шифрования/расшифровки и некоторых других криптографических операций. Также имеется поддержка к серверам ключей HKP и LDAP.

Программа основана на GnuPG и распространяется как свободное программное обеспечение под лицензией GNU GPL.

Ключ создается командой:

    ssh-keygen -t rs

Во время создания ключа нужно будет ответить на несколько вопросов, расположение оставляйте по умолчанию, если хотите подключаться без пароля — поле Passphare тоже оставьте пустым.

Затем отправляем ключ на сервер:

    ssh-copy-id -i ~/.ssh/id_rsa.pub user@host

~ интересный и могущественный символ, как, впрочем, все остальные. См.: РЕЦЕПТЫ LINUX — Глава 3. Служебные символы, а также, там же: Команды Linux.

Вот и все. Теперь при попытке подключится к этому серверу пароль запрашиваться не будет, а стазу произойдет подключение. Подробнее — см. материалы «Создание открытого ключа для ssh».

Между прочим: Параметры соединения не сервере видны так:

    # netstat -ntlp |grep ssh
    tcp  0  0 0.0.0.0:2226  0.0.0.0:*  LISTEN  757/sshd
    tcp6 0  0 :::2226       :::*       LISTE   757/sshd

В тему:

    «SSH Command» — (ssh.com).
    «SSH-AGENT — SINGLE SIGN-ON USING SSH» — (ssh.com: Январь 21, 2019).
    «Как подключиться по SSH» — (losst.ru: Январь 21, 2019).
    «Пароли и ключи: Seahorse — A GNOME encryption interface» — (wiki.gnome.org: Январь 21, 2019).
    «Как настроить ssh, чтобы не вводить пароль» — debian.org () .
    «Гуляем с сервера на сервер с одним ssh-ключом. SSH-agent forwarding» — Debian.pro .
    «Памятка пользователям ssh» — amarao (30 июля 2012) .
